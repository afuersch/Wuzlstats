version: '{build}'

os: Visual Studio 2015

branches:
  only:
    - master

build_script:
- cd ./src/Wuzlstats
- CALL dotnet restore
- CALL dotnet publish --configuration Release --output bin/publish

artifacts:
- path: ./src/Wuzlstats/bin/publish
  name: Web application

environment:
  deploy_server:
    secure: YmZFZZmWT1sVedoAdssDtJmzDbLqM4f5betXn9OGKgGSdIF3+0epfn/4AJwH280X
  deploy_username:
    secure: vUkM5f2EhdTuZYWcMkClTQ==
  deploy_password:
    secure: NVuYfhEOnbYxLwUsWWRSPeOidVMYqz6wOoGc22dVp5aJIlvWO/LYwj1VmApTMyHbQQlFOXsNOl58MMyEDrs4Jw==


deploy_script:
- CALL "C:\Program Files\IIS\Microsoft Web Deploy V3\msdeploy.exe" -verb:sync -source:recycleApp -dest:recycleApp=wuzlstats,recycleMode=StopAppPool,computername=%deploy_server%,username=%deploy_username%,password=%deploy_password%
- CALL "C:\Program Files\IIS\Microsoft Web Deploy V3\msdeploy.exe" -verb:sync -source:contentPath=%APPVEYOR_BUILD_FOLDER%\src\Wuzlstats\bin\publish -dest:contentPath=wuzlstats,computername=%deploy_server%,username=%deploy_username%,password=%deploy_password%
- CALL "C:\Program Files\IIS\Microsoft Web Deploy V3\msdeploy.exe" -verb:sync -source:recycleApp -dest:recycleApp=wuzlstats,recycleMode=StartAppPool,computername=%deploy_server%,username=%deploy_username%,password=%deploy_password%